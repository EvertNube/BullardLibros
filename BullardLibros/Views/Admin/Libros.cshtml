@using System.Globalization;
@model IList<BullardLibros.Core.DTO.CuentaBancariaDTO>
@{
    ViewBag.Title = "NubeLabs SCI - Libros";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
@section Styles{
    @Styles.Render("~/Content/themes/admin/js/datatables/css/dataTables.jqueryui.min.css")
    @Styles.Render("~/Content/themes/admin/js/datatables/datatables.css")
}
@section scripts{
    @Scripts.Render("~/Content/themes/admin/js/datatables/js/jquery.dataTables.min.js")
    <script type="text/javascript">
        $(function () {
            $('.dataTable').DataTable();
        });
        function funcTipoCambio() {
            var value = parseFloat($("#idTipoCambio").val()) || 0;
            if (value == 0) {
                value = 1;
                $("#idTipoCambio").val('1.00');
            }

            var valorSoles = parseFloat(@ViewBag.TotalSoles);
            var valorDolares = parseFloat(@ViewBag.TotalDolares);

            var totalConSoles = (valorDolares * value + valorSoles).toFixed(2);
            cadenaSoles = 'S/. ' + totalConSoles.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

            var totalConDolares = (valorSoles / value + valorDolares).toFixed(2);
            cadenaDolares = 'US$ ' + totalConDolares.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        };
        function funcTipoCambioSoles() {
            $("#idTotalConsolidado").html(cadenaSoles);
        };
        function funcTipoCambioDolares() {
            $("#idTotalConsolidado").html(cadenaDolares);
        };
        function funcTipoCambioActivado() {
            if ($("#idMonedaSoles").hasClass('active'))
            {
                return 1;
            }
            else if ($("#idMonedaDolares").hasClass('active'))
            {
                return 2;
            }
            return 0;
        }
    </script>
}

<section class="vbox">
    <section class="scrollable padder">
        <div class="row m-b">
            <div class="col-xs-12 col-md-12">
                <h2>Libros</h2>
                @Html.Partial("_showAlertMessages")
                <section class="panel panel-default">
                    <div class="panel-header">
                        <div class="col-sm-6 col-md-3 padder-v b-r b-light">
                            <span class="fa-stack fa-2x pull-left m-r-sm">
                                <i class="fa fa-circle fa-stack-2x text-warning"></i>
                                <i class="fa fa-money fa-stack-1x text-white"></i>
                            </span>
                            <a class="clear" href="#">
                                <small class="text-muted text-uc">Total Soles Disponibles</small>
                                <span class="h3 block m-t-xs"><strong id="idTotalSoles">S/. @ViewBag.TotalSoles.ToString("N2", CultureInfo.InvariantCulture)</strong></span>
                            </a>
                        </div>
                        <div class="col-sm-6 col-md-4 padder-v b-r b-light lt">
                            <span class="fa-stack fa-2x pull-left m-r-sm">
                                <i class="fa fa-circle fa-stack-2x text-success"></i>
                                <i class="fa fa-money fa-stack-1x text-white"></i>
                            </span>
                            <a class="clear" href="#">
                                <small class="text-muted text-uc">Total Dólares Disponibles</small>
                                <span class="h3 block m-t-xs"><strong id="idTotalDolares">US$ @ViewBag.TotalDolares.ToString("N2", CultureInfo.InvariantCulture)</strong></span>
                            </a>
                        </div>
                        <div class="col-sm-6 col-md-5 padder-v b-r b-light">
                            <div class="col-md-8 no-padder">
                                <span class="fa-stack fa-2x pull-left m-r-sm">
                                    <i class="fa fa-circle fa-stack-2x text-info"></i>
                                    <i class="fa fa-money fa-stack-1x text-white"></i>
                                </span>
                                <a class="clear" href="#">
                                    <small class="text-muted text-uc"><strong>Consolidado</strong></small>
                                    <span class="h3 block m-t-xs"><strong id="idTotalConsolidado">S/. @ViewBag.TotalConsolidado.ToString("N2", CultureInfo.InvariantCulture)</strong></span>
                                </a>
                            </div>
                            <div class="col-md-4 no-padder">
                                <form class="form-group no-padder m-n" role="form">
                                    <div class="form-inline text-center">
                                        <div class="col-md-3 no-padder">
                                            <label class="control-label label-sm" style="transform: translateY(35%)">TC:</label>
                                        </div>
                                        <div class="col-md-9 no-padder">
                                            <input id="idTipoCambio" type="text" class="form-control input-sm" style="text-align:right;" value="3.00" onkeyup="funcTipoCambio(); (funcTipoCambioActivado() == 1) ? funcTipoCambioSoles() : funcTipoCambioDolares();">
                                        </div>
                                    </div>
                                    <div class="form-inline no-padder text-center">
                                        <div class="btn-group m-t-sm" data-toggle="buttons">
                                            <label id="idMonedaSoles" class="btn btn-xs btn-default active" onclick="funcTipoCambio(); funcTipoCambioSoles();">
                                                <input type="radio" name="options" id="option1">
                                                <i class="fa fa-money text-warning">
                                                </i>
                                                PEN
                                            </label>
                                            <label id="idMonedaDolares" class="btn btn-xs btn-default" onclick="funcTipoCambio(); funcTipoCambioDolares();">
                                                <input type="radio" name="options" id="option2">
                                                <i class="fa fa-dollar text-success">
                                                </i>
                                                USD
                                            </label>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="panel panel-default">
                    @if (ViewBag.EsAdmin)
                    {
                        <header class="panel-heading">
                            <div class="row text-sm">
                                <div class="col-sm-8">
                                    <div class="btn-group">
                                        <label><input type="checkbox" id="btn-showInactive" /> Mostrar Inactivos</label>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <a class="btn btn-sm btn-success pull-right" href="@Url.Action("Libro")"><i class="fa fa-plus"></i> Crear nuevo Libro</a>
                                </div>
                            </div>
                        </header>
                    }
                    <div class="table-responsive">
                        <table class="table table-striped m-b-none dataTable no-footer">
                            <thead>
                                <tr>
                                    <th width="20%">Nombre</th>
                                    <th class="text-center" width="20%">Fecha</th>
                                    <th class="text-center" width="15%">Saldo Disponible</th>
                                    <th class="text-center" width="15%">Saldo Bancario</th>
                                    <th class="text-center" width="10%">Estado</th>
                                    <th class="text-center" width="20%">Opciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model != null)
                                {
                                    foreach (var obj in Model)
                                    {
                                        var classInactive = (!obj.Estado) ? "class='inactive'" : "";
                                        <tr @Html.Raw(classInactive)>
                                            <td width="20%">@obj.NombreCuenta</td>
                                            <td class="text-center" width="20%">@obj.FechaConciliacion.ToString("dd/MMM/yyyy", CultureInfo.CreateSpecificCulture("es-PE"))</td>
                                            <td class="text-right" width="15%">@obj.SimboloMoneda @obj.SaldoDisponible.ToString("N2", CultureInfo.InvariantCulture)</td>
                                            <td class="text-right" width="15%">@obj.SimboloMoneda @obj.SaldoBancario.ToString("N2", CultureInfo.InvariantCulture)</td>
                                            @if (obj.Estado == true)
                                            {
                                                <td class="text-center" width="10%">Activo</td>}
                                            else
                                            {
                                                <td class="text-center" width="10%">Inactivo</td>}

                                            @if (ViewBag.EsAdmin)
                                            {
                                                <td align="center"><a href="@Url.Action("Libro", new { id = obj.IdCuentaBancaria })"><i class="fa fa-pencil"></i></a></td>
                                            }
                                            else
                                            {
                                                <td align="center"><a href="@Url.Action("LibroVista", new { id = obj.IdCuentaBancaria })"><i class="fa fa-search"></i></a></td>
                                            }
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </section>
</section>
